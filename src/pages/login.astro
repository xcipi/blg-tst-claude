---
import Layout from '../layouts/Layout.astro';
import NavBar from '../components/NavBar.astro';
import Footer from '../components/Footer.astro';

export const prerender = false;

// Check if user is already authenticated via CF Access SSO
const isAuthenticated = Astro.locals.isAuthenticated || false;

// If already authenticated, redirect to admin
if (isAuthenticated) {
  return Astro.redirect('/admin');
}

// Get error from query params
const url = new URL(Astro.request.url);
const error = url.searchParams.get('error');

let errorMessage = '';
if (error === 'missing') {
  errorMessage = 'Pros√≠m vypl≈à v≈°etky polia';
} else if (error === 'invalid') {
  errorMessage = 'Nespr√°vne prihlasovacie √∫daje';
} else if (error === 'server') {
  errorMessage = 'Chyba servera, sk√∫s to znova';
}
---

<Layout title="Login - Admin Dashboard">
  <NavBar currentPath="/login" />
  
  <main class="min-h-screen pt-24 pb-16 px-4 flex items-center justify-center">
    <div class="max-w-md w-full">
      <div class="mb-8 text-center">
        <div class="text-emerald-500 font-mono text-sm mb-4">$ sudo login</div>
        <h1 class="text-3xl font-bold text-white mb-2">Admin Login</h1>
        <p class="text-gray-400">Prihl√°senie pre spr√°vcu obsahu</p>
      </div>

      {errorMessage && (
        <div class="bg-red-900/20 border border-red-500 text-red-400 px-4 py-3 rounded mb-6 font-mono text-sm">
          {errorMessage}
        </div>
      )}

      <div class="bg-[#111111] border border-gray-800 rounded-lg p-8">
        <form action="/api/auth/login" method="POST" class="space-y-4">
          <div>
            <label class="block text-gray-400 font-mono text-sm mb-2">Username</label>
            <input
              type="text"
              name="username"
              class="w-full bg-gray-900 border border-gray-800 rounded px-4 py-2 text-white font-mono focus:border-emerald-500 focus:outline-none"
              placeholder="admin"
              required
            />
          </div>
          <div>
            <label class="block text-gray-400 font-mono text-sm mb-2">Password</label>
            <input
              type="password"
              name="password"
              class="w-full bg-gray-900 border border-gray-800 rounded px-4 py-2 text-white font-mono focus:border-emerald-500 focus:outline-none"
              placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
              required
            />
          </div>
          <button 
            type="submit"
            class="w-full bg-emerald-500 text-black py-3 rounded font-mono font-bold hover:bg-emerald-400 transition-all"
          >
            Login ‚Üí
          </button>
        </form>

        <div class="mt-6 pt-6 border-t border-gray-800">
          <p class="text-gray-500 text-xs font-mono text-center">
            üí° Tip: Cloudflare Access chr√°ni tento endpoint
          </p>
        </div>
      </div>
    </div>
  </main>

  <Footer />
</Layout>
